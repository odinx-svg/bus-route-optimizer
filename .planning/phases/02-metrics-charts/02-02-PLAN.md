---
phase: 02-metrics-charts
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - frontend/src/components/metrics/AnimatedNumber.tsx
  - frontend/src/components/metrics/MetricCard.tsx
  - frontend/src/components/metrics/RoutesChart.tsx
autonomous: true

must_haves:
  truths:
    - "Numbers animate smoothly when values change"
    - "Metric cards display value, label, and trend indicator"
    - "Bar chart renders with dark theme colors"
  artifacts:
    - path: "frontend/src/components/metrics/AnimatedNumber.tsx"
      provides: "Spring-animated number display"
      exports: ["AnimatedNumber"]
    - path: "frontend/src/components/metrics/MetricCard.tsx"
      provides: "KPI card with GlassCard styling and trend arrow"
      exports: ["MetricCard"]
    - path: "frontend/src/components/metrics/RoutesChart.tsx"
      provides: "Recharts bar chart with dark theme"
      exports: ["RoutesChart"]
  key_links:
    - from: "frontend/src/components/metrics/MetricCard.tsx"
      to: "frontend/src/components/ui/GlassCard.tsx"
      via: "import"
      pattern: "import.*GlassCard.*from.*ui"
    - from: "frontend/src/components/metrics/MetricCard.tsx"
      to: "frontend/src/components/metrics/AnimatedNumber.tsx"
      via: "import"
      pattern: "import.*AnimatedNumber"
    - from: "frontend/src/components/metrics/RoutesChart.tsx"
      to: "recharts"
      via: "import"
      pattern: "import.*from.*recharts"
---

<objective>
Create the three core metric visualization components: AnimatedNumber (Framer Motion counter), MetricCard (KPI display with trend), and RoutesChart (Recharts bar chart).

Purpose: These components are the building blocks for the MetricsSidebar. Each is focused and testable independently.

Output: Three TypeScript React components in components/metrics/ directory, all using Phase 1 foundation (GlassCard, Tailwind theme, Framer Motion).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-metrics-charts/02-RESEARCH.md

# Phase 1 components
@frontend/src/components/ui/GlassCard.tsx
@frontend/src/components/ui/index.ts

# Phase 2-01 types (from previous plan)
@frontend/src/types/metrics.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create AnimatedNumber component</name>
  <files>frontend/src/components/metrics/AnimatedNumber.tsx</files>
  <action>
    Create `frontend/src/components/metrics/` directory if it doesn't exist.

    Create `frontend/src/components/metrics/AnimatedNumber.tsx`:

    ```typescript
    import { motion, useSpring, useTransform } from 'framer-motion';
    import { useEffect } from 'react';

    interface AnimatedNumberProps {
      value: number;
      className?: string;
      /** Number of decimal places to display */
      decimals?: number;
    }

    /**
     * Animated number counter using Framer Motion springs.
     * Updates smoothly when value changes without causing React re-renders.
     *
     * Based on BuildUI recipe: https://buildui.com/recipes/animated-number
     */
    export function AnimatedNumber({
      value,
      className = '',
      decimals = 0
    }: AnimatedNumberProps) {
      const spring = useSpring(value, {
        mass: 0.8,
        stiffness: 75,
        damping: 15
      });

      const display = useTransform(spring, (current) => {
        if (decimals > 0) {
          return current.toFixed(decimals);
        }
        return Math.round(current).toLocaleString();
      });

      useEffect(() => {
        spring.set(value);
      }, [spring, value]);

      return <motion.span className={className}>{display}</motion.span>;
    }
    ```

    Key points:
    - Uses useSpring from framer-motion (already installed in Phase 1)
    - Physics-based animation feels natural
    - useTransform avoids React re-renders during animation
    - Supports both integers and decimals via decimals prop
  </action>
  <verify>
    Run `npx tsc --noEmit` - no type errors.
    File exists with AnimatedNumber export.
    Import path `framer-motion` resolves correctly.
  </verify>
  <done>AnimatedNumber.tsx exists with spring-based animation, accepts value/className/decimals props</done>
</task>

<task type="auto">
  <name>Task 2: Create MetricCard component</name>
  <files>frontend/src/components/metrics/MetricCard.tsx</files>
  <action>
    Create `frontend/src/components/metrics/MetricCard.tsx`:

    ```typescript
    import { GlassCard } from '../ui';
    import { TrendingUp, TrendingDown, Minus } from 'lucide-react';
    import { AnimatedNumber } from './AnimatedNumber';
    import type { TrendDirection } from '../../types/metrics';

    interface MetricCardProps {
      /** Display label (e.g., "Total Buses") */
      label: string;
      /** Numeric value to display */
      value: number;
      /** Unit suffix (e.g., "%", "min", "km") */
      unit?: string;
      /** Trend direction for indicator arrow */
      trend?: TrendDirection;
      /** Optional trend description (e.g., "vs last week") */
      trendLabel?: string;
      /** Number of decimal places */
      decimals?: number;
    }

    const trendConfig = {
      up: {
        icon: TrendingUp,
        colorClass: 'text-neon-green',
        bgClass: 'bg-neon-green/10',
      },
      down: {
        icon: TrendingDown,
        colorClass: 'text-red-400',
        bgClass: 'bg-red-400/10',
      },
      neutral: {
        icon: Minus,
        colorClass: 'text-slate-400',
        bgClass: 'bg-slate-400/10',
      },
    };

    /**
     * KPI metric card with animated value and trend indicator.
     * Uses GlassCard from Phase 1 for consistent styling.
     */
    export function MetricCard({
      label,
      value,
      unit,
      trend = 'neutral',
      trendLabel,
      decimals = 0,
    }: MetricCardProps) {
      const { icon: TrendIcon, colorClass, bgClass } = trendConfig[trend];

      return (
        <GlassCard padding="sm" className="flex flex-col min-w-0">
          {/* Label */}
          <span className="text-xs text-slate-400 uppercase tracking-wider truncate">
            {label}
          </span>

          {/* Value + Unit */}
          <div className="flex items-baseline gap-1 mt-1">
            <AnimatedNumber
              value={value}
              decimals={decimals}
              className="text-2xl font-bold text-white"
            />
            {unit && (
              <span className="text-sm text-slate-400">{unit}</span>
            )}
          </div>

          {/* Trend indicator */}
          {trend !== 'neutral' && (
            <div className={`flex items-center gap-1 mt-2 ${colorClass}`}>
              <div className={`p-0.5 rounded ${bgClass}`}>
                <TrendIcon size={12} />
              </div>
              {trendLabel && (
                <span className="text-xs">{trendLabel}</span>
              )}
            </div>
          )}
        </GlassCard>
      );
    }
    ```

    Key points:
    - Imports GlassCard from '../ui' (Phase 1 barrel export)
    - Uses lucide-react icons (already installed)
    - TrendDirection type from types/metrics.ts
    - Trend colors: neon-green for up (good), red-400 for down (bad)
    - truncate class prevents long labels from breaking layout
  </action>
  <verify>
    Run `npx tsc --noEmit` - no type errors.
    File imports GlassCard, lucide-react icons, AnimatedNumber correctly.
    File exports MetricCard.
  </verify>
  <done>MetricCard.tsx exists with GlassCard styling, animated value, and trend indicator</done>
</task>

<task type="auto">
  <name>Task 3: Create RoutesChart component</name>
  <files>frontend/src/components/metrics/RoutesChart.tsx</files>
  <action>
    Create `frontend/src/components/metrics/RoutesChart.tsx`:

    ```typescript
    import {
      BarChart,
      Bar,
      XAxis,
      YAxis,
      Tooltip,
      ResponsiveContainer,
      CartesianGrid,
    } from 'recharts';
    import type { ChartDataPoint } from '../../types/metrics';

    interface RoutesChartProps {
      /** Array of data points with name and routes count */
      data: ChartDataPoint[];
      /** Chart height in pixels */
      height?: number;
    }

    /**
     * Bar chart showing routes distribution.
     * Configured for dark theme with neon-green bars.
     *
     * IMPORTANT: Parent container must have explicit height or min-height,
     * otherwise ResponsiveContainer collapses to 0px.
     */
    export function RoutesChart({ data, height = 200 }: RoutesChartProps) {
      if (!data || data.length === 0) {
        return (
          <div
            className="flex items-center justify-center text-slate-500 text-sm"
            style={{ height }}
          >
            No data available
          </div>
        );
      }

      return (
        <div style={{ height }}>
          <ResponsiveContainer width="100%" height="100%">
            <BarChart
              data={data}
              margin={{ top: 10, right: 10, left: -20, bottom: 0 }}
            >
              <CartesianGrid
                strokeDasharray="3 3"
                stroke="#1e293b"
                vertical={false}
              />
              <XAxis
                dataKey="name"
                tick={{ fill: '#94a3b8', fontSize: 11 }}
                axisLine={{ stroke: '#334155' }}
                tickLine={false}
                interval={0}
                angle={-45}
                textAnchor="end"
                height={60}
              />
              <YAxis
                tick={{ fill: '#94a3b8', fontSize: 11 }}
                axisLine={false}
                tickLine={false}
                allowDecimals={false}
              />
              <Tooltip
                contentStyle={{
                  backgroundColor: 'rgba(15, 23, 42, 0.95)',
                  border: '1px solid rgba(255, 255, 255, 0.1)',
                  borderRadius: '8px',
                  color: '#fff',
                  fontSize: '12px',
                }}
                cursor={{ fill: 'rgba(57, 255, 20, 0.1)' }}
              />
              <Bar
                dataKey="routes"
                fill="#39FF14"
                radius={[4, 4, 0, 0]}
                maxBarSize={40}
              />
            </BarChart>
          </ResponsiveContainer>
        </div>
      );
    }
    ```

    Key points:
    - Named imports from recharts (tree-shaking friendly)
    - Dark theme colors: #1e293b grid, #94a3b8 text, #334155 axis
    - Neon-green (#39FF14) bars match Tailwind theme
    - XAxis rotated 45 degrees for bus IDs that may be long
    - Wrapper div with explicit height prevents ResponsiveContainer collapse
    - Empty state handled gracefully
  </action>
  <verify>
    Run `npx tsc --noEmit` - no type errors.
    File imports from 'recharts' correctly (named imports only).
    File exports RoutesChart.
  </verify>
  <done>RoutesChart.tsx exists with dark theme styling, accepts ChartDataPoint[] data</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npx tsc --noEmit` passes with no errors
2. `npm run build` completes successfully
3. Files exist:
   - frontend/src/components/metrics/AnimatedNumber.tsx
   - frontend/src/components/metrics/MetricCard.tsx
   - frontend/src/components/metrics/RoutesChart.tsx
4. Each file has correct imports:
   - AnimatedNumber: framer-motion
   - MetricCard: GlassCard from ui, lucide-react, AnimatedNumber
   - RoutesChart: recharts (named imports)
</verification>

<success_criteria>
- AnimatedNumber uses Framer Motion useSpring for smooth animation
- MetricCard wraps GlassCard and shows value/label/trend
- MetricCard trend arrows: green (up), red (down)
- RoutesChart uses Recharts BarChart with dark theme colors
- All components TypeScript-typed and export correctly
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-metrics-charts/02-02-SUMMARY.md`
</output>
